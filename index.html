<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hey Dad, Let&apos;s Talk! — Memory Journal by Aleri Lizaro</title>

  <!-- TikTok Pixel (deterministic load) -->
  <script>
  (function (w, d, lib, id) {
    var q = w[lib] = w[lib] || [];
    q.methods = ["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"];
    q.setAndDefer = function (obj, method) { obj[method] = function(){ obj.push([method].concat([].slice.call(arguments,0))); }; };
    for (var i = 0; i < q.methods.length; i++) q.setAndDefer(q, q.methods[i]);

    // ← КЛЮЧЕВОЕ: заранее создаём структуры для конкретного Pixel ID
    q._i = q._i || {};
    q._t = q._t || {};
    q._o = q._o || {};
    q._i[id] = q._i[id] || [];
    q._i[id]._u = "https://analytics.tiktok.com/i18n/pixel/events.js";
    q._t[id] = +new Date();
    q._o[id] = q._o[id] || {};

    // сохраняем ID на всякий
    q.__active_id__ = id;
  })(window, document, "ttq", "D2VA91BC77UD68QFAUFG");
  </script>
  <!-- явная загрузка SDK; теперь events.js найдёт ttq._i[ID] и не упадёт -->
  <script async src="https://analytics.tiktok.com/i18n/pixel/events.js?sdkid=D2VA91BC77UD68QFAUFG&lib=ttq"></script>
  <script>ttq.page();</script>
</head>

<body>
  <div id="root"></div>
  <script type="module" src="/src/main.tsx"></script>

  <!-- Track Amazon clicks -->
  <script>
  (function () {
    if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') return;
    document.addEventListener('click', function (e) {
      const a = e.target && e.target.closest && e.target.closest('a[href*="amazon"]');
      if (!a) return;
      try {
        window.ttq && window.ttq.track('ClickButton', {
          button: 'amazon',
          url: a.href,
          book: document.title
        });
      } catch {}
    }, { capture: true });
  })();
  </script>
</body>
</html>
